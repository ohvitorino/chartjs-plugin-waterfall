!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("lodash/merge"),require("lodash/groupBy")):"function"==typeof define&&define.amd?define(["lodash/merge","lodash/groupBy"],o):t.chartjsPluginWaterfall=o(t.merge,t.groupBy)}(this,function(o,d){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o,d=d&&d.hasOwnProperty("default")?d.default:d;!function(){function u(t){this.value=t}function t(a){var r,s;function i(t,o){try{var e=a[t](o),n=e.value;n instanceof u?Promise.resolve(n.value).then(function(t){i("next",t)},function(t){i("throw",t)}):l(e.done?"return":"normal",e.value)}catch(t){l("throw",t)}}function l(t,o){switch(t){case"return":r.resolve({value:o,done:!0});break;case"throw":r.reject(o);break;default:r.resolve({value:o,done:!1})}(r=r.next)?i(r.key,r.arg):s=null}this._invoke=function(n,a){return new Promise(function(t,o){var e={key:n,arg:a,resolve:t,reject:o,next:null};s?s=s.next=e:(r=s=e,i(n,a))})},"function"!=typeof a.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}();var k=function(t){if(Array.isArray(t)){for(var o=0,e=Array(t.length);o<t.length;o++)e[o]=t[o];return e}return Array.from(t)},h=function(t,o,e,n){var a=e.stackBase,r=n.stackBase,s=e.stackTopYPos,i=n.stackTopYPos;if(s===r?(i=r,r=n.dummyStackBase):a===i&&(s=a,a=e.dummyStackBase),!e.isPositive&&n.isPositive&&(i=r,r=n.stackTopYPos),e.isPositive&&!n.isPositive&&(s=a,a=e.stackTopYPos),"line"===(e.options.type||o.type)){var l=e.options.lineColor||o.lineColor||"#000",u=e.options.lineWidth||o.lineWidth||1;return t.beginPath(),t.strokeStyle=l,t.lineWidth=u,t.moveTo(e.stackRightXPos,s),t.lineTo(n.stackLeftXPos,i),void t.stroke()}var c=i<s?s:i,f=r<a?a:r,p=t.createLinearGradient(0,c,0,f),d=e.options.startColor||o.startColor,k=e.options.endColor||o.endColor,h=e.options.startColorStop||o.startColorStop,y=e.options.endColorStop||o.endColorStop;p.addColorStop(h,d),p.addColorStop(y,k),t.fillStyle=p,t.beginPath(),t.lineTo(e.stackRightXPos,s),t.lineTo(n.stackLeftXPos,i),t.lineTo(n.stackLeftXPos,r),t.lineTo(e.stackRightXPos,a),t.fill()},e={waterFallPlugin:{stepLines:{enabled:!0,startColorStop:0,endColorStop:.6,startColor:"rgba(0, 0, 0, 0.55)",endColor:"rgba(0, 0, 0, 0)"}}},n={},a=function(t,o){return!o.datasets[t.datasetIndex].waterfall.dummyStack},r=function(t){t.data.datasets.forEach(function(t){t.waterfall=o({},{stepLines:{}},t.waterfall),t.waterfall.dummyStack&&(t.backgroundColor="rgba(0, 0, 0, 0)")})};return{beforeInit:function(t){n[t.id]={readyToDrawStepLines:!1}},afterInit:function(t){r(t),t.options.plugins=o({},e,t.options.plugins),t.options.tooltips.filter=a,t.options.legend.labels.filter=a,setTimeout(function(){n[t.id].readyToDrawStepLines=!0,null!==t.ctx&&t.draw()},t.options.animation.duration)},afterDraw:function(t){var o=t.options.plugins.waterFallPlugin;r(t),o.stepLines.enabled&&n[t.id].readyToDrawStepLines&&function(t){var o=t.ctx,e=t.data.datasets,n=t.options.plugins.waterFallPlugin.stepLines,i=d(e,"stack"),l=[],u=function(t){var o=Object.keys(t._meta)[0];return t._meta[o].data[0]._model};Object.keys(i).forEach(function(t){var o=i[t].filter(function(t){return 0!==t.data[0]});if(!o.every(function(t){return t.waterfall.dummyStack})){var e=o.filter(function(t){return!t.waterfall.dummyStack}).map(function(t){return u(t).base}),n=Math.max.apply(Math,k(e)),a=o.map(function(t){return u(t).base}),r=Math.max.apply(Math,k(a)),s=o.map(function(t){var o=u(t);return{stackRightXPos:o.x+o.width/2,stackLeftXPos:o.x-o.width/2,stackTopYPos:o.y,stackBase:n,dummyStackBase:r,isPositive:0<t.data[0],options:t.waterfall.stepLines}});l.push(s)}});for(var a=function(t){var o=t.length-1;return{stackRightXPos:t[o].stackRightXPos,stackLeftXPos:t[o].stackLeftXPos,stackTopYPos:t[o].stackTopYPos,stackBase:t[o].stackBase,dummyStackBase:t[o].dummyStackBase,isPositive:t[o].isPositive,options:t[o].options}},r=0;r<l.length;r+=1){var s=l[r];if(r!==l.length-1){var c=l[r+1],f=a(s),p=a(c);f.stackTopYPos!==p.stackTopYPos&&f.stackBase!==p.stackTopYPos&&f.stackTopYPos!==p.stackBase||h(o,n,f,p)}}}(t)}}});
//# sourceMappingURL=chartjs-plugin-waterfall.min.js.map
